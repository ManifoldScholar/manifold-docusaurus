(self.webpackChunkmanifold_docusaurus=self.webpackChunkmanifold_docusaurus||[]).push([[5992],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return c},kt:function(){return m}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(a),m=i,h=p["".concat(l,".").concat(m)]||p[m]||u[m]||r;return a?n.createElement(h,o(o({ref:t},c),{},{components:a})):n.createElement(h,o({ref:t},c))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},5480:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return o},metadata:function(){return s},toc:function(){return l},default:function(){return c}});var n=a(4034),i=a(9973),r=(a(7294),a(3905)),o={id:"spam",title:"Mitigating Spam",sidebar_label:"Mitigating Spam"},s={unversionedId:"administering/spam",id:"administering/spam",isDocsHomePage:!1,title:"Mitigating Spam",description:"Manifold employs three tactics to guard against bad actors taking advantage of the social components of the system: (1) email verification, coupled with a model of user trust; (2) rate limits levied against user engagements, and (3) integration with the spam-detection service, Akismet.",source:"@site/docs/administering/spam.md",sourceDirName:"administering",slug:"/administering/spam",permalink:"/manifold-docusaurus/docs/administering/spam",editUrl:"https://github.com/ManifoldScholar/manifold-docusaurus/edit/master/docs/administering/spam.md",version:"current",sidebar_label:"Mitigating Spam",frontMatter:{id:"spam",title:"Mitigating Spam",sidebar_label:"Mitigating Spam"},sidebar:"docs",previous:{title:"Securing Manifold",permalink:"/manifold-docusaurus/docs/administering/securing_manifold"},next:{title:"Managing Settings",permalink:"/manifold-docusaurus/docs/administering/configuring/managing_settings"}},l=[{value:"Email Verification",id:"email-verification",children:[]},{value:"User Trust",id:"user-trust",children:[]},{value:"Establishing Existing Users",id:"establishing-existing-users",children:[]},{value:"Rate Limits",id:"rate-limits",children:[]},{value:"Akismet",id:"akismet",children:[]},{value:"Finding and Deleting Spam",id:"finding-and-deleting-spam",children:[]}],d={toc:l};function c(e){var t=e.components,a=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Manifold employs three tactics to guard against bad actors taking advantage of the social components of the system: (1) email verification, coupled with a model of user trust; (2) rate limits levied against user engagements, and (3) integration with the spam-detection service, ",(0,r.kt)("a",{parentName:"p",href:"https://akismet.com/"},"Akismet"),"."),(0,r.kt)("h2",{id:"email-verification"},"Email Verification"),(0,r.kt)("p",null,"Beginning with v8.1, Manifold requires that new, ",(0,r.kt)("em",{parentName:"p"},"as well as existing"),", users verify the email address associated with their Manifold account. Users who fail to verify their accounts will not be allowed to leave public annotations, comment publicly, or create public reading groups. Until their email address is confirmed, unverified users will only be able to make private annotations or create and engage in private reading groups."),(0,r.kt)("p",null,"Because this step applies to new ",(0,r.kt)("em",{parentName:"p"},"and")," existing users, after upgrading to v8.1 or later, users who could engage publicly before the upgrade will need to verify their email address following the upgrade. See the ",(0,r.kt)("a",{parentName:"p",href:"/manifold-docusaurus/docs/using/your_account"},"Your Account")," section for more on the verification process."),(0,r.kt)("p",null,"However, there are caveats, and the following two sections describe some exceptions to this verification requirement."),(0,r.kt)("h2",{id:"user-trust"},"User Trust"),(0,r.kt)("p",null,"We constructed a user-trust model where trusted users can engage publicly on the system even if they have not verified their email address."),(0,r.kt)("p",null,"By default, users with Admin, Editor, Project Creator, or Marketeer roles are considered trusted members of the system and thus able to engage publicly, even when they have not verified their email address."),(0,r.kt)("p",null,"Additionally, users who have been granted access to modify a project in the backend using a project\u2019s ",(0,r.kt)("a",{parentName:"p",href:"/manifold-docusaurus/docs/backend/projects#access"},"Access sidebar")," are also considered trusted by the system and able to engage publicly with others."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/manifold-docusaurus/docs/backend/users"},"Users section")," for more about the different account roles available in Manifold."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"What about Authors?")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Currently ",(0,r.kt)("em",{parentName:"p"},"only")," users who have ",(0,r.kt)("strong",{parentName:"p"},"Can Modify Project")," toggled on from the Access sidebar are considered trusted. Users who have either the toggle for ",(0,r.kt)("strong",{parentName:"p"},"Can Modify Resource Metadata")," or ",(0,r.kt)("strong",{parentName:"p"},"Author")," activated are not viewed as trusted accounts and therefore cannot engage with others publicly\u2014unless or until they verify their email address."))),(0,r.kt)("h2",{id:"establishing-existing-users"},"Establishing Existing Users"),(0,r.kt)("p",null,"Through the ",(0,r.kt)("strong",{parentName:"p"},"User")," list view, located under the ",(0,r.kt)("strong",{parentName:"p"},"Records")," menu in the backend, users with Admin roles can bypass the above trust model and verification protocol and opt to manually verify a user as a trusted user. When a user is thusly verified, they will be able to engage publicly on the system, even if they haven\u2019t verified their email or otherwise qualify as a trusted user."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/manifold-docusaurus/docs/backend/users"},"Users section")," for more on how Admins can manually verify an account."),(0,r.kt)("h2",{id:"rate-limits"},"Rate Limits"),(0,r.kt)("p",null,"As of v8.0.7, the following rate limits are applied to all users who are ",(0,r.kt)("em",{parentName:"p"},"not")," Admins. These limits are in place as one method to guard against the proliferation of spam content."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A single user can make up to 5 public annotations in a 5 minute period."),(0,r.kt)("li",{parentName:"ul"},"A single IP address can make up to 5 public annotations in a 5 minute period."),(0,r.kt)("li",{parentName:"ul"},"A single user can make up to 10 comments in a 60 minute period."),(0,r.kt)("li",{parentName:"ul"},"A single IP address can make up to 10 comments in a 60 minute period."),(0,r.kt)("li",{parentName:"ul"},"A single user can make up to 10 public reading groups in a 60 minute period."),(0,r.kt)("li",{parentName:"ul"},"A single IP address can make up to 10 public reading groups in a 60 minute period."),(0,r.kt)("li",{parentName:"ul"},"A single real email can attempt to register up to 5 times within a day or else that email is banned for a month (n.b., aliases like ",(0,r.kt)("a",{parentName:"li",href:"mailto:zach+foo@gmail.com"},"zach+foo@gmail.com")," and ",(0,r.kt)("a",{parentName:"li",href:"mailto:zach+bar@gmail.com"},"zach+bar@gmail.com")," are be treated as the same email)."),(0,r.kt)("li",{parentName:"ul"},"A single IP address can attempt to register up to 5 times within a day or else that IP is banned for a month.")),(0,r.kt)("p",null,"It should be noted that the limits on annotations and reading groups described here are only applied if they are public. Comments are limited as noted, even if they are in response to annotations made in a private context."),(0,r.kt)("h2",{id:"akismet"},"Akismet"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://akismet.com/"},"Akismet")," is a spam detection and filtering service. When you associate your Akismet credentials with Manifold, Manifold will pass all comments, public reading group titles, and public annotations through Akismet to see if it\u2019s spam. If Akismet flags the content as spam, Manifold won\u2019t create it."),(0,r.kt)("p",null,"It is important to note that this filtering is applied only to users who have the default Reader role, regardless of whether they have verified their email address or been verified by an Admin. Users with Project Creator, Marketeer, Editor and Admin roles\u2014as well as Readers who have been granted permission to access and edit projects in the backend (i.e., \u201ctrusted\u201d users, as described above)\u2014are except from Akismet filtering. See the ",(0,r.kt)("a",{parentName:"p",href:"/manifold-docusaurus/docs/backend/users"},"Users section")," for more on these different roles."),(0,r.kt)("p",null,"If your Manifold instance is hosted by Manifold Digital Services, your instance is automatically filtering content against Akismet. If your instance is self-hosted you will need to sign up for Akismet and associate the API key they provide to you with your instance. See the ",(0,r.kt)("a",{parentName:"p",href:"/manifold-docusaurus/docs/administering/configuring/properties"},"Settings section")," for more on how to connect your instance with Akismet."),(0,r.kt)("p",null,"It is not currently possibly to make use of other spam-filtering services."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"API Limits")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It is important to note that the amount of content that Akismet will filter depends on the Akismet plan you select for your instance and how may API calls per month are allowed through that plan. If your instance makes more calls than the plan you selected from Akismet allows for, filtering will begin to fail silently and spam may appear on your site."))),(0,r.kt)("h2",{id:"finding-and-deleting-spam"},"Finding and Deleting Spam"),(0,r.kt)("p",null,"It's possible to query records in the database and bulk delete them, which can simplify cleaning up spam. The following instructions offer some starting point for finding and destroying spam using the console."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"With great power comes great responsibility. Using the console it is possible to permanently delete records in Manifold or otherwise corrupt stored data. Make sure you have a recent backup before performing console commands and proceed with care. Everything below this warning could potentially destroy data in your instance and cause problems."))),(0,r.kt)("p",null,"The Manifold API is a Rails Application, and like all rails applications can be interacted with via the console. If Manifold was installed from source, you can shell into the server and navigate to the api directory in the Manifold root. From there you can access a Rails console with ",(0,r.kt)("inlineCode",{parentName:"p"},"bundle exec rails console"),". If Manifold was installed from one of our packages, you can access the rails console with ",(0,r.kt)("inlineCode",{parentName:"p"},"manifold-api console"),"."),(0,r.kt)("p",null,"Once you're in the console, you can execute Ruby code that interacts with the models contained in the API application, which are generally mapped to rows in the database. If you need to clean up data, it should be done through the console rather than by executing SQL queries against the database. If you attempt to clean up data by querying the database directly, you run a greater risk of ending up with inconsistent data because no application validation and callback logic is executed when interacting with the database directly."),(0,r.kt)("p",null,"Once you're in the console, begin by attempting to select the records that you think are spam and assigning them to a variable. For example, on many instances we have seen spam attacks create public reading groups. Using the console, we can select all public reading groups created between two dates:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"groups_to_delete = ReadingGroup.where(\"privacy = 'public' AND created_at >= '2024-02-19' AND created_at <= '2024-02-20'\");\n")),(0,r.kt)("p",null,"Now that you have the groups you're targeting assigned to a variable, you can count them and make sure that you're targeting the expected number of records:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"groups_to_delete.count\n\n=> 2\n")),(0,r.kt)("p",null,"Or you can pluck specific columns from the results and review them as a sanity check:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},'groups_to_delete.pluck(:name)\n\n=> ["Self-Isolationists", "ENG 2100, Section ABC"]\n')),(0,r.kt)("p",null,"You can also find out what columns exist on a given model by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"column_names")," class method on the model."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},'ReadingGroup.column_names\n\n=> ["id", "name", "privacy", "invitation_code", "notify_on_join", "creator_id", "created_at", "updated_at", "reading_group_kind_id", "course"]\n')),(0,r.kt)("p",null,"You can also use full text search on fields to find the groups. In this example, the percentage signs are wildcards."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},'groups_to_delete = ReadingGroup.by_keyword("viagra");\n')),(0,r.kt)("p",null,"Model names in the API are fairly predictable. Users are ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," and Annotations are ",(0,r.kt)("inlineCode",{parentName:"p"},"Annotation"),", for example. For more on querying models, see Rails Documentation on ",(0,r.kt)("a",{parentName:"p",href:"https://guides.rubyonrails.org/active_record_querying.html"},"Active Record Querying"),"."),(0,r.kt)("p",null,"Once you've selected the records that you think are spam, and you've triple checked to make sure you're not going to accidentally delete valid models, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"destroy_all")," method to ",(0,r.kt)("em",{parentName:"p"},"permanently destroy")," these models. It's important that you call ",(0,r.kt)("inlineCode",{parentName:"p"},"destroy")," for a single model and ",(0,r.kt)("inlineCode",{parentName:"p"},"destroy_all")," for a set of models when you want to destroy data because these methods ensure that callbacks are executed. If you are destroying large numbers of records, it will take some time and you will see output scroll across the screen, which is normal."),(0,r.kt)("p",null,"Here's an example showing how you would select all public reading groups created between Feb 19 and Feb 20, 2024 and then permanently destroy those records:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"groups_to_delete = ReadingGroup.where(\"privacy = 'public' AND created_at >= '2024-02-19' AND created_at <= '2024-02-20'\");\ngroups_to_delete.destroy_all\n")),(0,r.kt)("p",null,"Again, be sure to back up your data before doing this and proceed with caution!"))}c.isMDXComponent=!0}}]);