<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-administering/backup_restore" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Backup and Restore | Manifold Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://manifoldscholar.github.io/manifold-docusaurus/img/Manifold-Marketing-Opengraph-3.png"><meta data-rh="true" property="og:url" content="https://manifoldscholar.github.io/manifold-docusaurus/docs/administering/backup_restore"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="theme-color" content="#52E3AC"><meta data-rh="true" name="og:image" content="/manifold-docusaurus/img/Manifold-Marketing-Opengraph-3.png"><meta data-rh="true" name="og:image:alt" content="People building a wooden Manifold logo. Text below the logo says &#x27;Manifold is what we make it&#x27;"><meta data-rh="true" name="twitter:image" content="/manifold-docusaurus/img/Manifold-Marketing-Opengraph-3.png"><meta data-rh="true" name="twitter:image:alt" content="People building a wooden Manifold logo. Text below the logo says &#x27;Manifold is what we make it&#x27;"><meta data-rh="true" name="msapplication-TileColor" content="#52E3AC"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Backup and Restore | Manifold Docs"><meta data-rh="true" name="description" content="The steps involved with backing up your instance and restoring from backup will vary depending on how you installed Manifold and what operating system you installed it on. The content on this page is meant to get you started. It is not exhaustive, nor have the scripts below been thoroughly tested in different environments."><meta data-rh="true" property="og:description" content="The steps involved with backing up your instance and restoring from backup will vary depending on how you installed Manifold and what operating system you installed it on. The content on this page is meant to get you started. It is not exhaustive, nor have the scripts below been thoroughly tested in different environments."><link data-rh="true" rel="canonical" href="https://manifoldscholar.github.io/manifold-docusaurus/docs/administering/backup_restore"><link data-rh="true" rel="alternate" href="https://manifoldscholar.github.io/manifold-docusaurus/docs/administering/backup_restore" hreflang="en"><link data-rh="true" rel="alternate" href="https://manifoldscholar.github.io/manifold-docusaurus/docs/administering/backup_restore" hreflang="x-default"><link data-rh="true" rel="icon" type="image/svg+xml" sizes="32x32" href="/manifold-docusaurus/favicon/favicon.svg"><link data-rh="true" rel="apple-touch-icon" sizes="180x180" href="/manifold-docusaurus/favicon/apple-touch-icon.png"><link data-rh="true" rel="manifest" href="/manifold-docusaurus/favicon/site.webmanifest"><link data-rh="true" rel="mask-icon" href="/manifold-docusaurus/favicon/safari-pinned-tab.svg" color="#52E3AC"><link data-rh="true" rel="stylesheet" href="https://use.typekit.net/utk2yhm.css"><link data-rh="true" rel="preconnect" href="https://W1ZE6PXIEV-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/manifold-docusaurus/blog/rss.xml" title="Manifold Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/manifold-docusaurus/blog/atom.xml" title="Manifold Docs Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Manifold Docs" href="/manifold-docusaurus/opensearch.xml"><link rel="stylesheet" href="/manifold-docusaurus/assets/css/styles.94332df1.css">
<script src="/manifold-docusaurus/assets/js/runtime~main.eec1aea3.js" defer="defer"></script>
<script src="/manifold-docusaurus/assets/js/main.f1b4c642.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="nav_XL5Y navWrapper_HYPi"><div class="nav__inner_FpCl"><a href="http://manifoldapp.org" class="link_fwQW" style="--_home-color:var(--green);--_home-hover-color:var(--text-color)"><svg viewBox="0 0 34 35" width="38" height="38" xmlns="http://www.w3.org/2000/svg" role="img" class="logo_z9gG"><title>Manifold logo</title><path fill-rule="evenodd" clip-rule="evenodd" d="M33.6 11.2l-2.5.8-3.9-1.5 6.4-2V6.3l-9.5 3.1-3.9-1.5 13.4-4.3V1.4L17.1 6.7.4.2v13.9L16 9.2v2.7L.4 16.8V19L16 14.1v2.7L.4 21.7v2.2L16 19v2.7L.4 26.6v2.2L16 23.9v2.7L.4 31.5v2.2L17 28.5l16.6 6.4z"></path></svg><span>Manifold</span></a><ul class="list_WUJ5"><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" href="http://manifoldapp.org/features" target="_self">Features</a></li><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" href="http://manifoldapp.org/community" target="_self">Community</a></li><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" href="http://manifoldapp.org/services" target="_self">Services</a></li><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" data-selected="true" href="/manifold-docusaurus/docs" target="_self">Docs</a></li><li class="list__item_GmKi"><a class="button_XSoC undefined" href="http://manifoldapp.org/get-started" target="_self">Get Started</a></li><li class="list__item_GmKi"><span class="text_hYiq" style="--_text-color:var(--text-color);--_text-font-size:var(--font-size-nav)">v 8.1.1<!-- --> </span></li></ul><button class="button_ZTPx" data-open="open" aria-controls="mobileMenu" aria-pressed="false"><span class="a-hidden">open<!-- --> navigation</span><svg viewBox="0 0 22 18" width="22" height="18" xmlns="http://www.w3.org/2000/svg" role="img"><title>Menu icon</title><path d="M22 15H0v-2h22v2zm0-10H0V3h22v2z"></path></svg></button><div class="nav__mobile-menu_IRus" data-open="false" role="region" id="mobileMenu" aria-live="polite"><button class="button_ZTPx" data-open="close" aria-controls="mobileMenu" aria-hidden="true"><span class="a-hidden">close<!-- --> navigation</span><svg viewBox="0 0 18 18" width="18" height="18" xmlns="http://www.w3.org/2000/svg" role="img"><title>x</title><path d="M17.4 2L16 .6l-7 7-7-7L.6 2l7 7-7 7L2 17.4l7-7 6.9 6.9 1.4-1.4L10.4 9z"></path></svg></button><ul class="list_WUJ5 list--is-mobile_vNJK"><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" href="http://manifoldapp.org/features" target="_self">Features</a></li><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" href="http://manifoldapp.org/community" target="_self">Community</a></li><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" href="http://manifoldapp.org/services" target="_self">Services</a></li><li class="list__item_GmKi"><a class="link_rbJj" style="--_link-font-size:var(--font-size-nav" data-selected="true" href="/manifold-docusaurus/docs" target="_self">Docs</a></li><li class="list__item_GmKi"><a class="button_XSoC undefined" href="http://manifoldapp.org/get-started" target="_self">Get Started</a></li><li class="list__item_GmKi"><span class="text_hYiq" style="--_text-color:var(--text-color);--_text-font-size:var(--font-size-nav)">v 8.1.1<!-- --> </span></li></ul></div></div></nav><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/manifold-docusaurus/"></a><a class="navbar__item navbar__link" href="/manifold-docusaurus/docs">Documentation</a><a class="navbar__item navbar__link" href="/manifold-docusaurus/docs/walkthroughs/landing">Walkthroughs</a><a class="navbar__item navbar__link" href="/manifold-docusaurus/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/manifold-docusaurus/docs">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/manifold-docusaurus/docs/accessibility">Accessibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/manifold-docusaurus/docs/administering/hosting">Administering Manifold</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/hosting">Hosting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/upgrading">Upgrading</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/manifold-docusaurus/docs/administering/release_notes/v8x">Release Notes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/managing_services">Managing Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/storage">Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/manifold-docusaurus/docs/administering/backup_restore">Backup and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/securing_manifold">Securing Manifold</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifold-docusaurus/docs/administering/spam">Mitigating Spam</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/manifold-docusaurus/docs/administering/configuring/managing_settings">Configuring Settings</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/manifold-docusaurus/docs/administering/reference/environment_variables">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/manifold-docusaurus/docs/using/manifold_library">Using Manifold</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/manifold-docusaurus/docs/backend/projects">Manifold Backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/manifold-docusaurus/docs/developers/local_development">Developers</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-vert--lg docItemWrapper_UBqo"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/manifold-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Administering Manifold</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Backup and Restore</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Backup and Restore</h1></header><p>The steps involved with backing up your instance and restoring from backup will vary depending on how you installed Manifold and what operating system you installed it on. The content on this page is meant to get you started. It is not exhaustive, nor have the scripts below been thoroughly tested in different environments.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Manifold is open-source software, and you are ultimately responsible for your data. Proceed with caution and make sure you understand what the following scripts do before you run them.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backup-manifold">Backup Manifold<a href="#backup-manifold" class="hash-link" aria-label="Direct link to Backup Manifold" title="Direct link to Backup Manifold">​</a></h2>
<p>Manifold stores user data in two places: (1) the PostgreSQL database and (2) the file system.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>It is also possible for Manifold to store files in cloud storage (AWS or GCS); however, backing up cloud storage buckets is outside the scope of these instructions.</p></div></div>
<p>Backing up a Manifold instance involves backing up files and creating a database dump. The specific commands required to backup a Manifold installation depend on how Manifold was installed. Select your installation type from the options below to see sample commands you can use for backing up your instance.</p>
<p>Each of the backup scripts below will create a tar archive that contains a <code>dump.sql</code> file and an <code>uploads</code> directory. These outputs can be used as inputs for the restore scripts that are described further below.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you downloaded one of our operating system packages for Centos or Ubuntu, follow the “Package Install” instructions. The “Source Install” instructions assumes that services are managed by systemd in an Ubuntu environment.</p></div></div>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Package Install</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Source Install</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Use this Bash script as a starting point for automating your instance backups. This script will need to be run as root.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define directories</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DIR=/var/opt/manifold/backups/`date +&quot;%m-%d-%y&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_STAGING=$BACKUP_DIR/staged</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_FILE=$BACKUP_DIR/manifold-backup-`date +&quot;%m-%d-%y-%s&quot;`.tar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_HOST=/var/opt/manifold/postgresql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_PORT=3034</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_USER=manifold</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_FILES_ROOT=/var/opt/manifold/api</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Create the staging directory (and parents) as the manifold user.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">su - manifold -c &quot;mkdir -p $BACKUP_STAGING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Dump the database to the staging directory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">su - manifold -c &quot;/opt/manifold/embedded/bin/pg_dump \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --user=$BACKUP_DB_USER \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --port=$BACKUP_DB_PORT \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --host=$BACKUP_DB_HOST manifold_production &gt; $BACKUP_STAGING/dump.sql&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Backup the uploads directory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $BACKUP_FILES_ROOT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -cvf $BACKUP_FILE uploads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Add the SQL dump to the tar archive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $BACKUP_STAGING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -rvf $BACKUP_FILE dump.sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $BACKUP_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Clean up the staging directory.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">su - manifold -c &quot;rm -rf $BACKUP_STAGING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Output backup path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Backup has been created at $BACKUP_FILE&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Use this Bash script as a starting point for automating your instance backups. This example assumes that your instance is installed at <code>/home/manifold/deploy/current</code> and that the files are owned by a <code>manifold</code> user.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># These should be set in the application user&#x27;s environment.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#RAILS_DB_NAME=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#RAILS_DB_PASS=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#RAILS_DB_USER=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">USER_DIR=/home/manifold</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DIR=$USER_DIR/backups/`date +&quot;%m-%d-%y&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_STAGING=$BACKUP_DIR/staged</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_FILE=$BACKUP_DIR/manifold-backup-`date +&quot;%m-%d-%y-%s&quot;`.tar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_HOST=localhost</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_PORT=5432</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_FILES_ROOT=/home/manifold/deploy/shared/api/public/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PG_URL=&quot;postgres://$RAILS_DB_USER:$RAILS_DB_PASS@$BACKUP_DB_HOST:$BACKUP_DB_PORT/$RAILS_DB_NAME&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Create the staging directory (and parents) as the manifold user.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Creating the staging directory at $BACKUP_STAGING...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p $BACKUP_STAGING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Dump the database to the staging directory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Creating a database dump...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pg_dump $PG_URL &gt; $BACKUP_STAGING/dump.sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Backup the uploads directory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Creating a tar archive...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $BACKUP_FILES_ROOT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -cf $BACKUP_FILE --transform=s/system/uploads/ system/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Add the SQL dump to the tar archive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Adding the dump to the archive...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $BACKUP_STAGING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -rf $BACKUP_FILE dump.sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $BACKUP_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Clean up the staging directory.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Cleaning the staging dir...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rm -rf $BACKUP_STAGING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Output backup path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Backup has been created at $BACKUP_FILE&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="restore-a-backup">Restore a Backup<a href="#restore-a-backup" class="hash-link" aria-label="Direct link to Restore a Backup" title="Direct link to Restore a Backup">​</a></h2>
<p>The following scripts take a single input, which is the path to a tar archive. That archive should include a database dump called <code>dump.sql</code> and a directory called <code>uploads</code> that includes attachment data. The backup scripts above will produce an archive that conforms to this specification.</p>
<p>Assuming you call the restore script <code>manifold-restore.sh</code> and you were in a directory with a backup generated by the backup script above, you would restore with this command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./manifold-restore.sh manifold-backup-11-17-20-1605640139.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Package Install</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Source Install</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>This script will need to be run as root.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RESTORE_DIR=/var/opt/manifold/backups/restore-staging</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RESTORE_ARCHIVE_PATH=$1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RESTORE_ARCHIVE_FILE=$(basename $RESTORE_ARCHIVE_PATH)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DB_HOST=/var/opt/manifold/postgresql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DB_PORT=3034</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DB_USER=manifold</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DB_NAME=manifold_production</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_FILES_ROOT=/var/opt/manifold/api</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TOKEN=$(cat /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 32 | head -n 1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ ! -f &quot;$RESTORE_ARCHIVE_PATH&quot; ]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;$RESTORE_ARCHIVE_PATH does not exist.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Creating the restore staging directory at $RESTORE_DIR...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">su - manifold -c &quot;mkdir -p $RESTORE_DIR&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Extracting the restore archive...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp $RESTORE_ARCHIVE_PATH $RESTORE_DIR/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $RESTORE_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -xf $RESTORE_ARCHIVE_FILE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Checking for an existing directory at $BACKUP_FILES_ROOT/uploads...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ -d $BACKUP_FILES_ROOT/uploads ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;$BACKUP_FILES_ROOT/uploads exists...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;Moving $BACKUP_FILES_ROOT/uploads to $BACKUP_FILES_ROOT/upload-bak-$TOKEN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mv $BACKUP_FILES_ROOT/uploads $BACKUP_FILES_ROOT/uploads-bak-$TOKEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Restoring uploads dir...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mv uploads $BACKUP_FILES_ROOT/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Backup existing DB to ~/manifold_production_dump-$TOKEN.sql&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">su - manifold -c &quot;/opt/manifold/embedded/bin/pg_dump \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --user=$DB_USER \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --port=$DB_PORT \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --host=$DB_HOST manifold_production &gt; ~/manifold_production_dump-$TOKEN.sql&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Stopping manifold services...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">manifold-ctl stop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Starting postgresql...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">manifold-ctl start postgresql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Dropping existing database...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DISABLE_DATABASE_ENVIRONMENT_CHECK=1 manifold-api db:drop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Create new database...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">manifold-api db:create</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Importing database dump...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">manifold-psql $DB_NAME &lt; dump.sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Starting services...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">manifold-ctl start</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Cleaning up the restore staging directory...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">su - manifold -c &quot;rm -rf $RESTORE_DIR&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Restore complete.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;You should reindex the content on your instance with this command:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;  manifold-api manifold:search:reindex&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># These should be set in the application user&#x27;s environment.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#RAILS_DB_NAME=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#RAILS_DB_PASS=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#RAILS_DB_USER=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">USER_DIR=/home/manifold</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CURRENT_DIR=$USER_DIR/deploy/current</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RESTORE_DIR=$USER_DIR/backups/restore-staging</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RESTORE_ARCHIVE_PATH=$1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RESTORE_ARCHIVE_FILE=$(basename $RESTORE_ARCHIVE_PATH)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_HOST=localhost</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_DB_PORT=5432</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BACKUP_FILES_ROOT=/home/manifold/deploy/shared/api/public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PG_URL=&quot;postgres://$RAILS_DB_USER:$RAILS_DB_PASS@$BACKUP_DB_HOST:$BACKUP_DB_PORT/$RAILS_DB_NAME&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TOKEN=$(cat /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 32 | head -n 1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Creating the restore staging directory at $RESTORE_DIR...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p $RESTORE_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Extracting the restore archive...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp $RESTORE_ARCHIVE_PATH $RESTORE_DIR/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $RESTORE_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -xf $RESTORE_ARCHIVE_FILE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Checking for an existing directory at $BACKUP_FILES_ROOT/system...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ -d $BACKUP_FILES_ROOT/system ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;$BACKUP_FILES_ROOT/system exists...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;Moving $BACKUP_FILES_ROOT/system to $BACKUP_FILES_ROOT/system-bak-$TOKEN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mv $BACKUP_FILES_ROOT/system $BACKUP_FILES_ROOT/system-bak-$TOKEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Restoring uploads dir to $BACKUP_FILES_ROOT/system...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mv uploads $BACKUP_FILES_ROOT/system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Backup existing DB to ~/manifold_production_dump-$TOKEN.sql&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pg_dump $PG_URL &gt; ~/manifold_production_dump-$TOKEN.sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Stopping manifold services...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl stop manifold</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Dropping existing database...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $CURRENT_DIR/api</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DISABLE_DATABASE_ENVIRONMENT_CHECK=1 rails db:drop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Create new database...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $CURRENT_DIR/api</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rails db:create</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Importing database dump...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $RESTORE_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">psql $PG_URL &lt; dump.sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Starting services...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo systemctl start manifold</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Cleaning up the restore staging directory...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rm -rf $RESTORE_DIR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Restore complete.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;You should reindex the content on your instance with these commands:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;  cd $CURRENT_DIR/api&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;  rails manifold:search:reindex&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ManifoldScholar/manifold-docusaurus/edit/master/docs/administering/backup_restore.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/manifold-docusaurus/docs/administering/storage"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label"><svg style="transform:rotate(180deg)" viewBox="0 0 25 16" width="25" height="16" xmlns="http://www.w3.org/2000/svg" role="img"><title>Directional arrow</title><path d="M17.7 15.7l-1.5-1.4L20.8 9H1V7h19.8l-4.6-5.3L17.7.3 24.3 8z"></path></svg><span>Storage</span></div></a><a class="pagination-nav__link pagination-nav__link--next" href="/manifold-docusaurus/docs/administering/troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label"><span>Troubleshooting</span><svg viewBox="0 0 25 16" width="25" height="16" xmlns="http://www.w3.org/2000/svg" role="img"><title>Directional arrow</title><path d="M17.7 15.7l-1.5-1.4L20.8 9H1V7h19.8l-4.6-5.3L17.7.3 24.3 8z"></path></svg></div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#backup-manifold" class="table-of-contents__link toc-highlight">Backup Manifold</a></li><li><a href="#restore-a-backup" class="table-of-contents__link toc-highlight">Restore a Backup</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer_HyyS footerWrapper_pz6f a-bg-black"><div class="footer__inner_NidK"><div class="footer__left_ghkj"><a href="http://manifoldapp.org" class="link_fwQW" style="--_home-color:var(--green);--_home-hover-color:var(--neutral50)"><svg viewBox="0 0 34 35" width="38" height="38" xmlns="http://www.w3.org/2000/svg" role="img" class="logo_z9gG"><title>Manifold logo</title><path fill-rule="evenodd" clip-rule="evenodd" d="M33.6 11.2l-2.5.8-3.9-1.5 6.4-2V6.3l-9.5 3.1-3.9-1.5 13.4-4.3V1.4L17.1 6.7.4.2v13.9L16 9.2v2.7L.4 16.8V19L16 14.1v2.7L.4 21.7v2.2L16 19v2.7L.4 26.6v2.2L16 23.9v2.7L.4 31.5v2.2L17 28.5l16.6 6.4z"></path></svg><span>Manifold</span></a></div><div class="footer__right_Mzkb"><nav class="footer__nav_wbGX"><div class="footer__link-group_PMvG"><h3 style="--_heading-color:var(--header-color);--_heading-span-color:var(--color-secondary);--_heading-font-weight:var(--font-weight-semi-bold)" class="heading_xhe0 undefined">Platform</h3><ul class="footer__link-list_Cnfg"><li><a href="http://manifoldapp.org/get-started" target="_self" rel="noopener noreferrer" class="link_t4xY"><span>Get Started</span></a></li><li><a href="http://manifoldapp.org/features" target="_self" rel="noopener noreferrer" class="link_t4xY"><span>Features</span></a></li><li><a href="http://manifoldapp.org/services" target="_self" rel="noopener noreferrer" class="link_t4xY"><span>Services</span></a></li><li><a class="link_t4xY" target="_self" href="/manifold-docusaurus/docs"><span>Docs</span></a></li><li><a class="link_t4xY" target="_self" href="/manifold-docusaurus/docs/accessibility"><span>Accessibility</span></a></li></ul></div><div class="footer__link-group_PMvG"><h3 style="--_heading-color:var(--header-color);--_heading-span-color:var(--color-secondary);--_heading-font-weight:var(--font-weight-semi-bold)" class="heading_xhe0 undefined">People</h3><ul class="footer__link-list_Cnfg"><li><a href="http://manifoldapp.org/community" target="_self" rel="noopener noreferrer" class="link_t4xY"><span>Community</span></a></li><li><a class="link_t4xY" href="/manifold-docusaurus/blog"><span>Blog</span></a></li><li><a href="http://manifoldapp.org/history" target="_self" rel="noopener noreferrer" class="link_t4xY"><span>About</span></a></li><li><a href="http://manifoldapp.org/development" target="_self" rel="noopener noreferrer" class="link_t4xY"><span>Development</span></a></li></ul></div><div class="footer__link-group_PMvG"><h3 style="--_heading-color:var(--header-color);--_heading-span-color:var(--color-secondary);--_heading-font-weight:var(--font-weight-semi-bold)" class="heading_xhe0 undefined">Contact</h3><ul class="footer__link-list_Cnfg"><li><a href="mailto:office@castironcoding.com" target="_blank" rel="noopener noreferrer" class="link_t4xY"><svg viewBox="0 0 33 32" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img"><title>Envelope</title><path d="M30.5 7h-27L17 18.2 30.5 7zM17 20.6L3.1 9.1V25h27.8V9.1L17 20.6z"></path></svg><span>Email</span></a></li><li><a href="https://github.com/ManifoldScholar" target="_blank" rel="noopener noreferrer" class="link_t4xY"><svg viewBox="0 0 33 32" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img"><title>Github logo</title><path d="M17 2C9.7 2 3.4 7 2.3 13.8s3.1 13.4 10 15.5c.7.1 1-.3 1-.7v-2.4c-4.2.8-5-1.9-5-1.9-.3-.8-.9-1.6-1.7-2-1.4-.9.1-.9.1-.9 1 .1 1.8.7 2.3 1.4.4.7 1.1 1.2 1.9 1.4.8.2 1.7.1 2.4-.3.1-.7.4-1.4.9-1.9-3.3-.4-6.8-1.6-6.8-6.9 0-1.4.5-2.7 1.5-3.8-.3-1-.3-2.3.3-3.5 0 0 1.3-.4 4.1 1.4 2.4-.6 5-.6 7.5 0 2.9-1.8 4.1-1.4 4.1-1.4.6 1.2.6 2.5.1 3.7 1 1 1.6 2.4 1.5 3.8 0 5.4-3.5 6.6-6.8 6.9.7.7 1.1 1.6 1 2.6v3.8c0 .4.3.8 1 .7 6.9-2.2 11.2-8.8 10-15.5S24.3 2 17 2"></path></svg><span>Github</span></a></li><li><a href="https://slack.com/" target="_blank" rel="noopener noreferrer" class="link_t4xY"><svg viewBox="0 0 33 32" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img"><title>Slack logo</title><path d="M20.9 24.1c1.7 0 3.1 1.3 3.1 2.9 0 1.6-1.4 2.9-3.1 2.9-1.7 0-3.1-1.3-3.1-2.9v-2.9h3.1zm-7.8-7.4c1.7 0 3.1 1.3 3.1 2.9V27c0 1.6-1.4 2.9-3.1 2.9-1.7 0-3.1-1.3-3.1-2.9v-7.4c-.1-1.5 1.3-2.9 3.1-2.9zm-4.7 0v2.9c0 1.6-1.4 2.9-3.1 2.9-1.7 0-3.1-1.3-3.1-2.9 0-1.6 1.4-2.9 3.1-2.9h3.1zm20.4 0c1.7 0 3.1 1.3 3.1 2.9 0 1.6-1.4 2.9-3.1 2.9h-7.9c-1.7 0-3.1-1.3-3.1-2.9 0-1.6 1.4-2.9 3.1-2.9h7.9zM13.1 9.4c1.7 0 3.1 1.3 3.1 2.9 0 1.6-1.4 2.9-3.1 2.9H5.2c-1.7 0-3.1-1.3-3.1-2.9 0-1.6 1.4-2.9 3.1-2.9h7.9zm15.7 0c1.7 0 3.1 1.3 3.1 2.9 0 1.6-1.4 2.9-3.1 2.9h-3.1v-2.9c-.1-1.6 1.4-2.9 3.1-2.9zM20.9 2C22.6 2 24 3.3 24 4.9v7.4c0 1.6-1.4 2.9-3.1 2.9-1.7 0-3.1-1.3-3.1-2.9V4.9c0-1.6 1.4-2.9 3.1-2.9zm-7.8 0c1.7 0 3.1 1.3 3.1 2.9v2.9h-3.1c-1.7 0-3.1-1.3-3.1-2.9C9.9 3.3 11.3 2 13.1 2z" fill-rule="evenodd" clip-rule="evenodd"></path></svg><span>Slack</span></a></li><li><a href="https://twitter.com/manifoldscholar" target="_blank" rel="noopener noreferrer" class="link_t4xY"><svg viewBox="0 0 33 32" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img"><title>Twitter logo</title><path d="M31.9 7.3c-1.1.5-2.3.8-3.5.9 1.3-.7 2.2-1.8 2.7-3.2-1.2.7-2.5 1.1-3.9 1.4-1.9-1.9-4.9-2.4-7.4-1.1s-3.7 3.8-3.1 6.4c-4.9-.2-9.5-2.4-12.6-6-1.6 2.6-.8 6 1.9 7.7-1 0-1.9-.3-2.8-.7v.1c0 2.7 2.1 5.1 4.9 5.6-.9.2-1.8.3-2.8.1.8 2.3 3.1 3.9 5.7 4-2 1.5-4.7 2.4-7.5 2.4-.5 0-1 0-1.5-.1 2.8 1.7 6.1 2.6 9.4 2.6 11.3 0 17.4-8.8 17.4-16.3v-.7c1.3-.9 2.3-1.9 3.1-3.1z"></path></svg><span>Twitter</span></a></li></ul></div></nav><p class="footer__copyright_Kd5L">© <!-- -->2024<!-- --> Manifold</p></div></div></footer></div>
</body>
</html>